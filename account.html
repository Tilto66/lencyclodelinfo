<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://kit.fontawesome.com/f5298b46cc.js" crossorigin="anonymous"></script>
     <script src="/articles/socket.io.js"></script>
    <!-- Mon stylesheet -->
    <link rel="stylesheet" href="./css/main.css">
    <!-- Mon js -->
    <script src="js/main.js"></script>
    <!-- bootstrap (3) - pour le style de la page. -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'encyclopédie de l'info - Accueil</title>
</head>
<body bgcolor="grey">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <a href="./accueil.html" class="navbar-brand">L'encyclo de l'info - <script>document.write(localStorage.getItem("username"));</script></a>
        </div>
        <ul class="nav navbar-nav">
            <li class="active"><a href="./accueil.html">Accueil</a></li>
            <li class="active"><a href="./index.html">Methodes de connexion</a></li>
            <li class="active"><a href="./idx.html" class="active">Index des articles</a></li>
            <li class="active"><a href="./credits.html">A propos...</a></li>
            <li class="active"><a href="#" onclick="deco();">Se déconnecter</a></li>
            <li class="dropdown active">
                <a href="#" data-toggle="dropdown" class="dropdown-toogle"><i class="fa-solid fa-circle-user"></i><span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="/account.html">Mon compte</a></li>
                </ul>
            </li>
        </ul>

            <!-- <li ><a href="#"><i class="fa-solid fa-circle-user"></i></a></li> -->
    </nav>

    <div class="txt article">
        <h1>Mon compte</h1>
        <div class="details">
            <img  id="accountpicture">
            <p><b><span style="font-size: 30px;" id="accountname"></span></b>: <br> 
            Compte créé le <span style="font-size: 26px;" id="accountdate"></span></p>
            Rang: <span id="rank"></span>
            
        </div>
    </div>


    
</body>
<script>
socket = io("http://dailya.freeboxos.fr:3630/");
const name = document.getElementById("accountname")
const image = document.getElementById("accountpicture");
const date = document.getElementById("accountdate");
const rank = document.getElementById("rank");
image.setAttribute("src",`/users/${localStorage.getItem("username")}.png`);
image.setAttribute("alt","Photo de profile introuvable")
socket.emit("getInfo",localStorage.getItem("IP"), localStorage.getItem("username"), (response) => {
    if (response != "301") {
        let parsedRes = JSON.parse(response);
        name.innerHTML = parsedRes['name'];
        date.innerHTML = parsedRes['date'];
        rank.innerHTML = parsedRes['rank'];
        rank.setAttribute("style",`color:${parsedRes['rankColor']}`)
        name.setAttribute("style",`color:${parsedRes['rankColor']}`)        
    } else {
        console.error("Rip erreur 301 mdr")
    }
}); // arg = IP, arg1 = account
function deco(){
    socket.emit("deco",localStorage.getItem("username"),localStorage.getItem("IP"), (response) => {
        if (response == "200") {
            localStorage.removeItem("username");
            window.location.href = "/";
        } else if (response=="500"){
            console.error("??? (erreur 500)");
        }
    })
}
window.addEventListener('load', function() {
  image.classList.add('loaded');
});

</script>
</html>